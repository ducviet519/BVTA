@model DataBVTA.Models.ViewModels.DanhSachDangKyKhamBenh
@{
    var region = ViewData["Region"] as string;
}

<!-- /.row -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title head-text">Danh sách đăng ký khám chữa bệnh</h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="PhongKham" class="col-form-label col-auto">Phòng khám:</label>
                            <div class="col-auto">
                                <select class="form-control selectPhongKham" id="PhongKham1" name="PhongKham1" asp-items="@Model.PhongKham">
                                    <option value="-1" selected="selected">Tất cả phòng khám</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-info ml-5" id="searchKCB">Tìm kiếm</button>
                        </div>
                    </div>
                    <div class="col-6"></div>
                </div>
                <table class="table table-bordered table-hover text-nowrap" width="100%" id="dangKyKCBTable">
                    <thead class="thead">
                        <tr>
                            <th>STT</th>
                            <th>Phòng khám</th>
                            <th>Tổng số</th>
                            <th>Chưa khám</th>
                            <th>CLS</th>
                            <th>Chờ kết quả</th>
                            <th>Đã khám</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <!-- /.card -->
    </div>
</div>
<!-- /.row -->
<script type="text/javascript">
    (function () {
        document.querySelector('body').addEventListener('scriptsLoaded', function () {

            $(function () {
                var phongKham = $("#PhongKham1").find(":selected").val();
                var hoTenKH = "";

                var searchTerm1 = "param=1";
                if (phongKham != "")
                    searchTerm1 += "&phongKham=" + phongKham;
                if ($.trim(hoTenKH) != "")
                    searchTerm1 += "&mabn=" + encodeURIComponent($.trim(hoTenKH));

                var columnData = [
                    { "data": "stt" },
                    { "data": "tenphongkham" },
                    { "data": "tongso" },
                    {
                        "data": { chuakham: "chuakham", maphongkham: "maphongkham" },
                        "render": function (data, title, row) {
                            return '<a class="btn btn-link btn-sm" data-toggle="ajax-modal" data-target="#phongkhamCXK-' + row.id + '" data-url="/CoXuongKhop/DanhSachChuaKham?mapk=' + data.maphongkham + '">' + data.chuakham + '</a>';
                        }
                    },
                    { "data": "cls" },
                    { "data": "coketqua" },
                    { "data": "dakham" },
                ]
                searchDataTable("#dangKyKCBTable", columnData, "/CoXuongKhop/GetDanhSachChoKham?" + searchTerm1, 10, "");

                $('#searchKCB').on('click', function () {
                    var phongKham = $("#PhongKham1").find(":selected").val();
                    var hoTenKH = "";

                    var searchTerm1 = "param=1";
                    if (phongKham != "")
                        searchTerm1 += "&phongKham=" + phongKham;
                    if ($.trim(hoTenKH) != "")
                        searchTerm1 += "&mabn=" + encodeURIComponent($.trim(hoTenKH));
                    searchDataTable("#dangKyKCBTable", columnData, "/CoXuongKhop/GetDanhSachChoKham?" + searchTerm1, 10, "");
                });
            });

        });
    })();
</script>
