@model DataBVTA.Models.ViewModels.DanhSachDangKyKhamBenh
<!-- /.row -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title head-text">Danh sách chờ khám</h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group row">
                            <label for="PhongKham" class="col-form-label col-auto">Phòng khám:</label>
                            <div class="col-auto">
                                <select class="form-control selectPhongKham" id="PhongKham2" name="PhongKham2" asp-items="@Model.PhongKham">
                                    <option value="-1" selected="selected">Tất cả phòng khám</option>
                                </select>
                            </div>
                            <label for="HoTenKH" class="col-form-label col-auto ml-5">PID/Họ tên KH:</label>
                            <div class="col-auto">
                                <input type ="text" class="form-control" id="HoTenKH" name="HoTenKH"/>
                            </div>
                            <button class="btn btn-info ml-5" id="searchChoKham">Tìm kiếm</button>
                        </div>
                    </div>
                </div>
                <table class="table table-bordered table-hover text-nowrap" width="100%" id="choKhamTable">
                    <thead class="thead">
                        <tr>
                            <th>STT</th>
                            <th>Giờ đăng ký</th>
                            <th>Phòng khám</th>
                            <th>Mã khách hàng</th>
                            <th>Họ tên</th>
                            <th>Năm sinh</th>
                            <th>Giờ hẹn</th>
                            <th>Dịch vụ</th>
                            <th>Ghi chú</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <!-- /.card -->
    </div>
</div>
<!-- /.row -->
<script type="text/javascript">
    (function () {
        document.querySelector('body').addEventListener('scriptsLoaded', function () {

            $(function () {
                var phongKham = $("#PhongKham2").find(":selected").val();
                var hoTenKH = ((document.getElementById("HoTenKH") || {}).value) || "";

                var searchTerm2 = "param=2";
                if (phongKham != "")
                    searchTerm2 += "&phongKham=" + phongKham;
                if ($.trim(hoTenKH) != "")
                    searchTerm2 += "&mabn=" + encodeURIComponent($.trim(hoTenKH));

                var columnChoKham = [
                    { "data": "stt" },
                    { "data": "giodk" },
                    { "data": "tenphongkham" },
                    { "data": "mabn" },
                    { "data": "hoten" },
                    { "data": "namsinh" },
                    { "data": "giohen" },
                    { "data": "tenchidinh" },
                    { "data": "ghichu" },
                    {
                        "data": { mabn: "mabn", maphongkham: "maphongkham" },
                        "render": function (data, row) { return "<a class='btn btn-link btn-sm' href='/CoXuongKhop/PhieuKhamBenh?mabn=" + data.mabn + "&maphongkham=" + data.maphongkham + "'  onclick=PhieuKhamBenh('" + row.id + "'); >Xác nhận</a>"; }
                    },
                ]
                searchDataTable("#choKhamTable", columnChoKham, "/CoXuongKhop/GetDanhSachChoKham?" + searchTerm2, 10, "0,9");

                $('#searchChoKham').on('click', function () {
                    var phongKham = $("#PhongKham2").find(":selected").val();
                    var hoTenKH = ((document.getElementById("HoTenKH") || {}).value) || "";

                    var searchTerm2 = "param=2";
                    if (phongKham != "")
                        searchTerm2 += "&phongKham=" + phongKham;
                    if ($.trim(hoTenKH) != "")
                        searchTerm2 += "&mabn=" + encodeURIComponent($.trim(hoTenKH));

                    searchDataTable("#choKhamTable", columnChoKham, "/CoXuongKhop/GetDanhSachChoKham?" + searchTerm2, 10, "0,9");
                });
            });

        });
    })();
</script>